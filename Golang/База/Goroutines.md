```go
import (
    "fmt"
    "time"
)

func say(s string) {
    for i := 0; i < 3; i++ {
        time.Sleep(100 * time.Millisecond)
        fmt.Println(s)
    }
}

func main() {
    go say("world")

    go func(msg string) {
        fmt.Println(msg)
    }("going")
    
    say("hello")
}
```
**Вывод:**
```
going
world
hello
world
hello
world
hello
```
- Реализация [[Parallelism VS Сoncurrency|concurrency]]
- При создании новой **горутины**, **планировщик** ставит ее в очередь на выполнение
- Переключение между **горутинами** происходит во время **блокировки** текущей
- Функция `main` - тоже **горутина**
- Можно использовать с [[Функции#Анонимные функции|анонимными функциями]]

## Способы блокировки

- Вызов примитивов блокировок из [[Полезные пакеты#sync|пакета]] `sync`
- Вызов метода `sleep` из [[Полезные пакеты#time|пакета]] `time`
- Чтение или запись из [[Channels|канала]]
- Сетевые операции

## [[Полезные пакеты#`sync`|Примитивы блокировок]]

```go
numbers := []int{1, 2, 3, 4, 5}
var wg sync.WaitGroup
for _, n := range numbers {
	wg.Add(1)
	go func() {
		printIfOdd(n)
		wg.Done()
	}()
	wg.Wait()
}
```
- Нужны вместо каналов для создания блокировок
- `Add(n)` - добавляет `n` к счетчику
- `Done()` - отнимает 1 у счетчика
- `Wait()` - блокирует горутину, пока счетчик не обнулится

## Threads VS Goroutines

| Потоки                                                                 | Горутины                                                                                                          |
| ---------------------------------------------------------------------- | ----------------------------------------------------------------------------------------------------------------- |
| Потоки ОС управляются ядром ОС                                         | Горутины управляются рантаймом Go                                                                                 |
| Обычно имеют фиксированный размер в 1-2 MB                             | Обычно имеют размер стека 2KB                                                                                     |
| Размер стека определяется во время компиляции и не может увеличиваться | Размер стека определяется во время рантайма и может расти до 1GB благодаря аллокации и освобождения места из хипа |
| Нету простого способа коммуникации между собой                         | Используют [[Channels\|каналы]] для быстрого общения                                                              |
